# Phase 2 血缘图字段展示方案

**Issue ID**: P2-LINEAGE-002
**Priority**: Medium
**Status**: Recommendation
**Created**: 2025-12-23
**Reporter**: QC Agent (Claude)
**Assignee**: Gemini (Frontend Agent)

---

## 问题描述

当表包含大量字段（例如 100+ 字段）时，如果在血缘图中全部展示会导致：

### 性能问题
- ReactFlow 渲染几百个字段节点会导致卡顿
- 大量节点和边会消耗大量内存

### 可用性问题
- 密密麻麻的字段无法阅读
- 难以找到特定字段
- 字段级血缘线会交织成一团

---

## 推荐方案：分层展示 + 按需加载

### 方案 1: 折叠/展开模式（推荐用于 Phase 2）

#### 默认状态：只显示表节点

```
┌─────────────────────┐
│  orders             │
│  📊 125 fields      │  ← 显示字段数量
│  [Expand Fields]    │  ← 展开按钮
└─────────────────────┘
```

**优点**：
- 默认视图简洁，性能好
- 用户可以按需展开感兴趣的表

#### 展开后：显示前 10 个字段 + "查看更多"

```
┌─────────────────────┐
│  orders             │
│  ─────────────────  │
│  • order_id    [PK] │
│  • customer_id      │
│  • amount           │
│  • created_at       │
│  • updated_at       │
│  • status           │
│  • payment_method   │
│  • shipping_address │
│  • billing_address  │
│  • notes            │
│  ⋮ +115 more fields │  ← 点击打开字段列表弹窗
│  [Collapse]         │
└─────────────────────┘
```

**优点**：
- 显示最重要的字段（主键、前 N 个）
- 提供"查看更多"入口
- 性能可控（只渲染展开的表的字段）

#### 点击"查看更多"：打开字段列表弹窗

**弹窗内容**：
- 搜索框（过滤字段）
- 完整字段列表（虚拟滚动）
- 点击字段可以高亮显示其血缘关系

---

### 方案 2: 智能过滤模式（可选）

**只显示有血缘关系的字段**：
- 默认只渲染有上游/下游血缘的字段
- 没有血缘关系的字段不显示
- 提供"显示所有字段"选项

**优点**：
- 聚焦于有血缘关系的字段
- 大幅减少渲染节点数量
- 适合血缘分析场景

---

## 推荐实现（Phase 2）

### 优先级 1: 折叠/展开（必须）
- 默认折叠，显示字段数量
- 展开显示前 10 个字段
- "+N more fields" 链接

### 优先级 2: 字段列表弹窗（推荐）
- 点击"+N more fields"打开弹窗
- 搜索和虚拟滚动
- 点击字段高亮血缘

### 优先级 3: 智能过滤（可选）
- 只显示有血缘的字段
- 可以延后到 Phase 3

---

**Document Version**: v1.0
**Status**: Recommendation for Gemini
